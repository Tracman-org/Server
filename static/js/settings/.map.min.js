"use strict";function checkSetterEmail(e,t){void 0===e?$(".vehicle-setter").each(function(e){checkSetterEmail($(this))}):(void 0===t&&(t=e.attr("data-vehicle")),$("#vehicle-setter-icon-"+t).removeClass("green fa-check red fa-times fa-exclamation").addClass("fa-spinner fa-spin").attr("title","Checking if a user has this email address"),$.get({url:"/validate?user="+e.val(),statusCode:{200:function(){$("#vehicle-setter-icon-"+t).removeClass("red fa-times fa-exclamation fa-spinner fa-spin").addClass("green fa-check").attr("title","This email is associated with an existing user"),$("#submit-btn").prop("disabled",!1).attr("title","Save your settings")},404:function(){$("#vehicle-setter-icon-"+t).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","No Tracman user has this email"),$("#submit-btn").prop("disabled",!0).attr("title","All vehicle setters must represent real users above")}}}).fail(function(){$("#vehicle-setter-icon-"+t).removeClass("green fa-check fa-times fa-spinner fa-spin").addClass("red fa-exclamation").attr("title","Could not check if this email is associated with a Tracman user. Are you still connected to the internet?"),$("#submit-btn").prop("disabled",!1).attr("title","Try to save your settings")}))}$(function(){const e=$("#slug-input").val();checkSetterEmail(),$("#slug-input").change(function(){$("#slug-input").val()?$("#slug-input").val()===e?($("#slug-help").hide(),$("#submit-btn").prop("disabled",!1).attr("title","Save your settings")):replaceFromEndpoint("slugify","#slug-input",function(){$.get({url:"/validate?slug="+$("#slug-input").val(),statusCode:{204:function(){$("#slug-help").hide(),$("#submit-btn").prop("disabled",!1).attr("title","Save your settings")},409:function(){$("#slug-help").show().text("That URL is already in use by another map."),$("#submit-btn").prop("disabled",!0).attr("title","Supply a different URL above")}}}).fail(function(){$("#email-help").show().text("Unable to confirm unique URL.  Are you still connected to the internet?"),$("#submit-btn").prop("disabled",!1).attr("title","Try to save your settings")})}):($("#slug-help").show().text("A URL is required. "),$("#submit-btn").prop("disabled",!0).attr("title","You need to enter a URL above"))}),$("table").on("change",".vehicle-setter",function(){const e=$(this).attr("data-vehicle")||"new",t=$(this).val();t?validateEmail(t)?(checkSetterEmail($(this),e),"new"===e?$("#vehicle-new").css("cursor","pointer").attr("title","Click to add a new vehicle"):$("#submit-btn").prop("disabled",!1).attr("title","Save your settings")):($("#vehicle-setter-icon-"+e).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","That email address isn't valid"),"new"===e?$("#vehicle-new").css("cursor","not-allowed").attr("title","That email address isn't valid"):$("#submit-btn").prop("disabled",!0).attr("title","All vehicle setters must have valid email addresses")):($("#vehicle-setter-icon-"+e).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","An email is required!"),"new"===e?$("#vehicle-new").css("cursor","not-allowed").attr("title","A setter email is required"):$("#submit-btn").prop("disabled",!0).attr("title","You need to enter an email address for each vehicle setter"))}),$("table").on("click",".vehicle-delete",function(){const e=$(this),t=e.closest("tr");$("#vehicles-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("red fa-times-circle").css("cursor","not-allowed"),$.ajax({type:"DELETE",url:window.location.pathname+"/vehicles/"+$(this).attr("data-vehicle"),statusCode:{200:function(e){t.remove()}}}).fail(function(){$("#vehicles-help").show().text("Failed to delete that vehicle.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("red fa-times-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")})}),$("#vehicle-new").click(function(){const e=$(this),t=$(this).closest("tr");$("#vehicles-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("green fa-plus-circle").css("cursor","not-allowed"),$.post({url:window.location.pathname+"/vehicles/",data:{name:$("#vehicle-name-new").val(),setter:$("#vehicle-setter-new").val(),marker:$("#vehicle-marker-new").val()},statusCode:{201:function(a){t.before('<tr>            <td>              <input class="xss-sensitive" type="text" name="vehicle-name-'+a.id+'" value="'+a.name+'" placeholder="Vehicle names are optional" title="The name of a vehicle appears when you mouseover or click on a marker on the map">\t\t\t\t    </td>  \t\t\t\t\t<td class="setter">  \t\t\t\t\t\t<input type="text" class="vehicle-setter left" data-vehicle="'+a.id+'" name="vehicle-setter-'+a.id+'" value="'+a.setter+'" placeholder="Enter an email" title="The email address of the user account that can set the vehicle\'s location">  \t\t\t\t\t\t<i id="vehicle-setter-icon-'+a.id+'" class="fa fa-spinner fa-spin"></i>  \t\t\t\t\t</td>  \t\t\t\t\t<td>  \t\t\t\t\t\t<select name="marker-'+a.id+'" title="The color of the map marker">  \t\t\t\t\t\t\t<option '+("red"===a.marker?"selected ":"")+'value="red">red</option>  \t\t\t\t\t\t\t<option '+("black"===a.marker?"selected ":"")+'value="black">black</option>  \t\t\t\t\t\t\t<option '+("green"===a.marker?"selected ":"")+'value="green">green</option>  \t\t\t\t\t\t\t<option '+("grey"===a.marker?"selected ":"")+'value="grey">grey</option>  \t\t\t\t\t\t\t<option '+("orange"===a.marker?"selected ":"")+'value="orange">orange</option>  \t\t\t\t\t\t\t<option '+("purple"===a.marker?"selected ":"")+'value="purple">purple</option>  \t\t\t\t\t\t\t<option '+("white"===a.marker?"selected ":"")+'value="white">white</option>  \t\t\t\t\t\t\t<option '+("yellow"===a.marker?"selected ":"")+'value="yellow">yellow</option>  \t\t\t\t\t\t</select>  \t\t\t\t\t</td>  \t\t\t\t\t<td>  \t\t\t\t\t\t<a><i data-vehicle="'+a.id+'" class="vehicle-delete fa fa-times-circle red"></i></a>  \t\t\t\t\t</td>\t\t\t\t  </tr>'),checkSetterEmail($('.vehicle-setter[data-vehicle="'+a.id+'"]')),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer"),$("#vehicle-name-new").val(""),$("#vehicle-setter-new").val(""),$("#vehicle-marker-new").val("red")}}}).fail(function(){$("#vehicles-help").show().text("Failed to add vehicle.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")})})});