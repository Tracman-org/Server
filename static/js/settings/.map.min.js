"use strict";function checkSetterEmail(e,t){console.log("checkSetterEmail("+e+", "+t+")"),void 0===e?$(".vehicle-setter").each(function(e){$(this).attr("data-vehicle")&&checkSetterEmail($(this),$(this).attr("data-vehicle"))}):($("#vehicle-setter-icon-"+t).removeClass("green fa-check red fa-times fa-exclamation").addClass("fa-spinner fa-spin").attr("title","Checking if a user has this email address"),$.get({url:"/validate?user="+e.val(),statusCode:{200:function(){$("#vehicle-setter-icon-"+t).removeClass("red fa-times fa-exclamation fa-spinner fa-spin").addClass("green fa-check").attr("title","This email is associated with an existing user")},404:function(){$("#vehicle-setter-icon-"+t).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","No Tracman user has this email")}}}).fail(function(){$("#vehicle-setter-icon-"+t).removeClass("green fa-check fa-times fa-spinner fa-spin").addClass("red fa-exclamation").attr("title","Could not check if this email is associated with a Tracman user. Are you still connected to the internet?")}))}function dimCenterInputs(){$("#center-follow-radio").is(":checked")?($("#center-follow-vehicle").css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}).prop("disabled",!1),$("#center-static-coords input").css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}).prop("disabled",!0)):$("#center-static-radio").is(":checked")&&($("#center-follow-vehicle").css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}).prop("disabled",!0),$("#center-static-coords input").css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}).prop("disabled",!1))}$(function(){const e=$("#slug-input").val();function t(){console.log("addVehicle() called");const e=$("#vehicle-new"),t=e.closest("tr"),a=$("#vehicle-setter-icon-new").attr("class"),i=$("#vehicle-setter-new").val();$("#vehicles-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("green fa-plus-circle").css("cursor","not-allowed"),i?validateEmail(i)?(console.log("sending request to",window.location.pathname+"/vehicles/new/"),$.post({url:window.location.pathname+"/vehicles/new/",data:{name:$("#vehicle-name-new").val(),setter:$("#vehicle-setter-new").val(),marker:$("#vehicle-marker-new").val()},statusCode:{201:function(i){console.log("successfully added with res of:",i),t.before('<tr>              <td>                <input class="xss-sensitive" type="text" name="vehicle-name-'+i.id+'" value="'+i.name+'" placeholder="Vehicle names are optional" title="The name of a vehicle appears when you mouseover or click on a marker on the map">              </td>              <td class="setter">                <input type="text" class="vehicle-setter left" data-vehicle="'+i.id+'" name="vehicle-setter-'+i.id+'" value="'+i.setter+'" placeholder="Enter an email" title="The email address of the user account that can set the vehicle\'s location">                <i id="vehicle-setter-icon-'+i.id+'" class="'+a+'"></i>              </td>              <td>                <select name="marker-'+i.id+'" title="The color of the map marker">                  <option '+("red"===i.marker?"selected ":"")+'value="red">red</option>                  <option '+("black"===i.marker?"selected ":"")+'value="black">black</option>                  <option '+("green"===i.marker?"selected ":"")+'value="green">green</option>                  <option '+("grey"===i.marker?"selected ":"")+'value="grey">grey</option>                  <option '+("orange"===i.marker?"selected ":"")+'value="orange">orange</option>                  <option '+("purple"===i.marker?"selected ":"")+'value="purple">purple</option>                  <option '+("white"===i.marker?"selected ":"")+'value="white">white</option>                  <option '+("yellow"===i.marker?"selected ":"")+'value="yellow">yellow</option>                </select>              </td>              <td>                <a><i data-vehicle="'+i.id+'" class="vehicle-delete fa fa-times-circle red"></i></a>              </td>            </tr>'),checkSetterEmail($('.vehicle-setter[data-vehicle="'+i.id+'"]'),i.id),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer"),$("#vehicle-name-new").val("").focus(),$("#vehicle-setter-new").val(""),$("#vehicle-marker-new").val("red")}}}).fail(function(){$("#vehicles-help").show().text("Failed to add vehicle.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")})):($("#vehicles-help").show().text("That setter email is invalid. "),$("#setter-new").focus(),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","not-allowed").attr("title","Enter a valid setter email")):($("#vehicles-help").show().text("A setter email is required"),$("#setter-new").focus(),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","not-allowed").attr("title","A setter email is required"))}function a(){console.log("addAdmin() called");const e=$("#admin-new"),t=e.closest("li"),a=$("#admin-new-email").val();$("#admins-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("green fa-plus-circle").css("cursor","not-allowed"),a?validateEmail(a)?$.post({url:window.location.pathname+"/admins/",data:{email:$("#admin-new-email").val()},statusCode:{201:function(a){t.before("<li>              "+a.email+' <a><i data-admin="'+a.email+'" class="admin-delete fa fa-times-circle red" title="Remove '+a.email+' from admins"></i></a>            </li>'),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer"),$("#admin-new-email").val("").focus()}}}).fail(function(){$("#vehicles-help").show().text("Failed to add admin.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer"),$("#admin-new-email").focus()}):($("#admins-help").show().text("That email address isn't valid"),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")):($("#admins-help").show().text("Type an email address in the box, then click here to add it"),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer"))}$(".container").easytabs(),$(".tab").click(function(){$(".container").easytabs("select",$(this).children("a").attr("href"))}),checkSetterEmail(),$("#slug-input").change(function(){$("#slug-input").val()?$("#slug-input").val()===e?($("#slug-help").hide(),$("#basics .submit.btn").prop("disabled",!1).attr("title","Save your settings")):replaceFromEndpoint("slugify","#slug-input",function(){$.get({url:"/validate?slug="+$("#slug-input").val(),statusCode:{204:function(){$("#slug-help").hide(),$("#basics .submit.btn").prop("disabled",!1).attr("title","Save your settings")},409:function(){$("#slug-help").show().text("That URL is already in use by another map."),$("#basics .submit.btn").prop("disabled",!0).attr("title","Supply a different URL above")}}}).fail(function(){$("#email-help").show().text("Unable to confirm unique URL.  Are you still connected to the internet?"),$("#basics .submit.btn").prop("disabled",!1).attr("title","Try to save your settings")})}):($("#slug-help").show().text("A URL is required. "),$("#basics .submit.btn").prop("disabled",!0).attr("title","You need to enter a URL above"))}),dimCenterInputs(),$("#map-center .button.col input").change(dimCenterInputs),$('#center-static-coords input[name="staticLat"]').change(function(){const e=parseFloat($(this).val());e>90?$("#map-center-lat-help").show().text("Latitudes are always less than 90."):e<-90?$("#map-center-lat-help").show().text("Latitudes are always greater than -90."):$("#map-center-lat-help").hide()}),$('#center-static-coords input[name="staticLon"]').change(function(){const e=parseFloat($(this).val());e>180?$("#map-center-lon-help").show().text("Longitudes are always less than 180."):e<-180?$("#map-center-lon-help").show().text("Longitudes are always greater than -180."):$("#map-center-lon-help").hide()}),$("#vehicles-table").on("change",".vehicle-setter",function(){let e=$(this).attr("data-vehicle");void 0===e&&(e="new");const t=$(this).val();t?validateEmail(t)?(checkSetterEmail($(this),e),"new"===e&&$("#vehicle-new").css("cursor","pointer").attr("title","Click to add a new vehicle")):($("#vehicle-setter-icon-"+e).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","That email address isn't valid"),"new"===e&&$("#vehicle-new").css("cursor","not-allowed").attr("title","That email address isn't valid")):"new"===e?$("#vehicle-setter-icon-"+e).hide():($("#vehicle-setter-icon-"+e).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","An email is required!"),"new"===e&&$vehicle_add_button.css("cursor","not-allowed").attr("title","A setter email is required"))}),$("#vehicle-new").click(t),$("#vehicles form").submit(function(e){console.log("vehicle submit intercepted"),$(".new-vehicle-input").is(":focus")&&(console.log("new vehicle has focus"),e.preventDefault(),t())}),$("#vehicles-table").on("click",".vehicle-delete",function(){const e=$(this),t=e.closest("tr");$("#vehicles-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("red fa-times-circle").css("cursor","not-allowed"),$.ajax({type:"DELETE",url:window.location.pathname+"/vehicles/"+$(this).attr("data-vehicle"),statusCode:{200:function(e){t.remove()}}}).fail(function(){$("#vehicles-help").show().text("Failed to delete that vehicle.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("red fa-times-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")})}),$("#admin-new").click(a),$("#admins form").submit(function(e){e.preventDefault(),a()}),$("#admins-list").on("click",".admin-delete",function(){const e=$(this),t=e.closest("li");$("#admins-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("red fa-times-circle").css("cursor","not-allowed"),$.ajax({type:"DELETE",url:window.location.pathname+"/admins/"+$(this).attr("data-admin"),statusCode:{200:function(e){t.remove()}}}).fail(function(){$("#admins-help").show().text("Failed to delete that admin.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("red fa-times-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")})})});