"use strict";function checkSetterEmail(e,t){void 0===e?$(".vehicle-setter").each(function(e){$(this).attr("data-vehicle")&&checkSetterEmail($(this),$(this).attr("data-vehicle"))}):($("#vehicle-setter-icon-"+t).removeClass("green fa-check red fa-times fa-exclamation").addClass("fa-spinner fa-spin").attr("title","Checking if a user has this email address"),$.get({url:"/validate?user="+e.val(),statusCode:{200:function(){$("#vehicle-setter-icon-"+t).removeClass("red fa-times fa-exclamation fa-spinner fa-spin").addClass("green fa-check").attr("title","This email is associated with an existing user")},404:function(){$("#vehicle-setter-icon-"+t).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","No Tracman user has this email")}}}).fail(function(){$("#vehicle-setter-icon-"+t).removeClass("green fa-check fa-times fa-spinner fa-spin").addClass("red fa-exclamation").attr("title","Could not check if this email is associated with a Tracman user. Are you still connected to the internet?")}))}$(function(){$(".container").easytabs(),$(".tab").click(function(){$(".container").easytabs("select",$(this).children("a").attr("href"))});const e=$("#slug-input").val();checkSetterEmail(),$("#slug-input").change(function(){$("#slug-input").val()?$("#slug-input").val()===e?($("#slug-help").hide(),$("#basics .submit.btn").prop("disabled",!1).attr("title","Save your settings")):replaceFromEndpoint("slugify","#slug-input",function(){$.get({url:"/validate?slug="+$("#slug-input").val(),statusCode:{204:function(){$("#slug-help").hide(),$("#basics .submit.btn").prop("disabled",!1).attr("title","Save your settings")},409:function(){$("#slug-help").show().text("That URL is already in use by another map."),$("#basics .submit.btn").prop("disabled",!0).attr("title","Supply a different URL above")}}}).fail(function(){$("#email-help").show().text("Unable to confirm unique URL.  Are you still connected to the internet?"),$("#basics .submit.btn").prop("disabled",!1).attr("title","Try to save your settings")})}):($("#slug-help").show().text("A URL is required. "),$("#basics .submit.btn").prop("disabled",!0).attr("title","You need to enter a URL above"))}),$("table").on("change",".vehicle-setter",function(){let e=$(this).attr("data-vehicle");void 0===e&&(e="new");const t=$(this).val();t?validateEmail(t)?(checkSetterEmail($(this),e),"new"===e&&$("#vehicle-new").css("cursor","pointer").attr("title","Click to add a new vehicle")):($("#vehicle-setter-icon-"+e).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","That email address isn't valid"),"new"===e&&$("#vehicle-new").css("cursor","not-allowed").attr("title","That email address isn't valid")):"new"===e?$("#vehicle-setter-icon-"+e).hide():($("#vehicle-setter-icon-"+e).removeClass("green fa-check fa-exclamation fa-spinner fa-spin").addClass("red fa-times").attr("title","An email is required!"),"new"===e&&$("#vehicle-new").css("cursor","not-allowed").attr("title","A setter email is required"))}),$("table").on("click",".vehicle-delete",function(){const e=$(this),t=e.closest("tr");$("#vehicles-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("red fa-times-circle").css("cursor","not-allowed"),$.ajax({type:"DELETE",url:window.location.pathname+"/vehicles/"+$(this).attr("data-vehicle"),statusCode:{200:function(e){t.remove()}}}).fail(function(){$("#vehicles-help").show().text("Failed to delete that vehicle.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("red fa-times-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")})}),$("#vehicle-new").click(function(){const e=$(this),t=$(this).closest("tr"),a=$("#vehicle-setter-icon-new").attr("class");$("#vehicles-help").hide(),t.css({filter:"alpha(opacity=50)","-moz-opacity":"0.5","-khtml-opacity":"0.5",opacity:"0.5"}),e.addClass("fa-spinner fa-spin").css("color","#FFF").removeClass("green fa-plus-circle").css("cursor","not-allowed"),$.post({url:window.location.pathname+"/vehicles/",data:{name:$("#vehicle-name-new").val(),setter:$("#vehicle-setter-new").val(),marker:$("#vehicle-marker-new").val()},statusCode:{201:function(i){t.before('<tr>            <td>              <input class="xss-sensitive" type="text" name="vehicle-name-'+i.id+'" value="'+i.name+'" placeholder="Vehicle names are optional" title="The name of a vehicle appears when you mouseover or click on a marker on the map">\t\t\t\t    </td>  \t\t\t\t\t<td class="setter">  \t\t\t\t\t\t<input type="text" class="vehicle-setter left" data-vehicle="'+i.id+'" name="vehicle-setter-'+i.id+'" value="'+i.setter+'" placeholder="Enter an email" title="The email address of the user account that can set the vehicle\'s location">  \t\t\t\t\t\t<i id="vehicle-setter-icon-'+i.id+'" class="'+a+'"></i>  \t\t\t\t\t</td>  \t\t\t\t\t<td>  \t\t\t\t\t\t<select name="marker-'+i.id+'" title="The color of the map marker">  \t\t\t\t\t\t\t<option '+("red"===i.marker?"selected ":"")+'value="red">red</option>  \t\t\t\t\t\t\t<option '+("black"===i.marker?"selected ":"")+'value="black">black</option>  \t\t\t\t\t\t\t<option '+("green"===i.marker?"selected ":"")+'value="green">green</option>  \t\t\t\t\t\t\t<option '+("grey"===i.marker?"selected ":"")+'value="grey">grey</option>  \t\t\t\t\t\t\t<option '+("orange"===i.marker?"selected ":"")+'value="orange">orange</option>  \t\t\t\t\t\t\t<option '+("purple"===i.marker?"selected ":"")+'value="purple">purple</option>  \t\t\t\t\t\t\t<option '+("white"===i.marker?"selected ":"")+'value="white">white</option>  \t\t\t\t\t\t\t<option '+("yellow"===i.marker?"selected ":"")+'value="yellow">yellow</option>  \t\t\t\t\t\t</select>  \t\t\t\t\t</td>  \t\t\t\t\t<td>  \t\t\t\t\t\t<a><i data-vehicle="'+i.id+'" class="vehicle-delete fa fa-times-circle red"></i></a>  \t\t\t\t\t</td>\t\t\t\t  </tr>'),checkSetterEmail($('.vehicle-setter[data-vehicle="'+i.id+'"]')),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer"),$("#vehicle-name-new").val(""),$("#vehicle-setter-new").val(""),$("#vehicle-marker-new").val("red")}}}).fail(function(){$("#vehicles-help").show().text("Failed to add vehicle.  Are you still conected to the internet?  "),t.css({filter:"","-moz-opacity":"","-khtml-opacity":"",opacity:""}),e.addClass("green fa-plus-circle").removeClass("fa-spinner fa-spin").css("cursor","pointer")})})});